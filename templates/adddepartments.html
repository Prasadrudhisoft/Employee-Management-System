<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Add Department | EMS Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        :root {
            --sidebar-width: 280px;
            --header-height: 75px;
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --primary-lighter: #c7d2fe;
            --primary-glow: rgba(99,102,241,0.35);
            --secondary: #0ea5e9;
            --bg-body: #f8fafc;
            --bg-sidebar: #ffffff;
            --bg-white: #ffffff;
            --bg-card: #ffffff;
            --bg-light: #f1f5f9;
            --bg-lighter: #f8fafc;
            --bg-gradient: linear-gradient(135deg, #eef2ff 0%, #e0e7ff 100%);
            --text-dark: #0f172a;
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-muted: #94a3b8;
            --border-color: #e2e8f0;
            --border-light: #f1f5f9;
            --success: #10b981;
            --success-light: #d1fae5;
            --warning: #f59e0b;
            --warning-light: #fef3c7;
            --danger: #ef4444;
            --danger-light: #fee2e2;
            --info: #0ea5e9;
            --info-light: #e0f2fe;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.04), 0 1px 2px rgba(0,0,0,0.03);
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
            --shadow-md: 0 10px 15px -3px rgba(0,0,0,0.06);
            --shadow-lg: 0 20px 25px -5px rgba(0,0,0,0.07);
            --radius-sm: 8px;
            --radius: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --radius-2xl: 24px;
        }
        html { font-size: 16px; scroll-behavior: smooth; }
        body { font-family: 'Inter', sans-serif; background: var(--bg-body); color: var(--text-primary); min-height: 100vh; -webkit-font-smoothing: antialiased; }
        ::-webkit-scrollbar { width: 6px; } ::-webkit-scrollbar-track { background: transparent; } ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 10px; }

        /* ── Sidebar ── */
        .sidebar { position: fixed; top: 0; left: 0; width: var(--sidebar-width); height: 100vh; background: var(--bg-sidebar); border-right: 1px solid var(--border-color); z-index: 100; display: flex; flex-direction: column; transition: transform 0.3s cubic-bezier(0.4,0,0.2,1); }
        .sidebar-header { padding: 24px 20px; border-bottom: 1px solid var(--border-color); display: flex; align-items: center; gap: 14px; }
        .logo-box { width: 48px; height: 48px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); border-radius: var(--radius-lg); display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 24px var(--primary-glow); flex-shrink: 0; }
        .logo-box i { font-size: 20px; color: white; }
        .logo-info h1 { font-size: 22px; font-weight: 800; color: var(--text-dark); letter-spacing: -0.03em; }
        .logo-info span { font-size: 11px; font-weight: 600; color: var(--primary); text-transform: uppercase; letter-spacing: 0.08em; }
        .admin-profile-card { margin: 20px 16px; padding: 20px; background: var(--bg-gradient); border-radius: var(--radius-xl); border: 1px solid var(--primary-lighter); }
        .admin-profile-inner { display: flex; align-items: center; gap: 14px; }
        .admin-avatar { width: 52px; height: 52px; border-radius: var(--radius-lg); background: linear-gradient(135deg, var(--primary), var(--secondary)); display: flex; align-items: center; justify-content: center; position: relative; box-shadow: 0 6px 20px var(--primary-glow); flex-shrink: 0; }
        .admin-avatar i { font-size: 22px; color: white; }
        .admin-avatar .status-indicator { position: absolute; bottom: -3px; right: -3px; width: 16px; height: 16px; background: var(--success); border: 3px solid var(--bg-white); border-radius: 50%; }
        .admin-meta h4 { font-size: 15px; font-weight: 700; color: var(--text-dark); margin-bottom: 3px; }
        .admin-meta p { font-size: 12px; color: var(--primary); font-weight: 600; }
        .admin-role-badge { margin-top: 16px; display: flex; align-items: center; gap: 10px; padding: 10px 14px; background: rgba(99,102,241,0.12); border-radius: var(--radius); font-size: 12px; font-weight: 600; color: var(--primary-dark); }
        .sidebar-nav { flex: 1; padding: 16px; overflow-y: auto; }
        .nav-section { margin-bottom: 28px; }
        .nav-section-label { font-size: 10px; font-weight: 800; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.12em; padding: 8px 16px; margin-bottom: 8px; }
        .nav-link { display: flex; align-items: center; gap: 14px; padding: 14px 18px; border-radius: var(--radius-lg); color: var(--text-secondary); text-decoration: none; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; margin-bottom: 4px; position: relative; }
        .nav-link:hover { background: var(--bg-light); color: var(--text-dark); }
        .nav-link:hover i { color: var(--primary); }
        .nav-link.active { background: linear-gradient(135deg, rgba(99,102,241,0.12), rgba(99,102,241,0.06)); color: var(--primary-dark); font-weight: 600; }
        .nav-link.active::before { content: ''; position: absolute; left: 0; top: 50%; transform: translateY(-50%); width: 4px; height: 28px; background: linear-gradient(180deg, var(--primary), var(--primary-dark)); border-radius: 0 6px 6px 0; }
        .nav-link.active i { color: var(--primary); }
        .nav-link i { width: 22px; font-size: 18px; text-align: center; color: var(--text-muted); transition: all 0.2s; }
        .nav-link .badge { margin-left: auto; padding: 4px 10px; background: linear-gradient(135deg, var(--danger), #dc2626); border-radius: 20px; font-size: 11px; font-weight: 700; color: white; min-width: 26px; text-align: center; }
        .nav-link .badge.info { background: linear-gradient(135deg, var(--info), #0284c7); }
        .nav-link .badge.warning { background: linear-gradient(135deg, var(--warning), #d97706); }
        .sidebar-footer { padding: 20px 16px; border-top: 1px solid var(--border-color); }
        .logout-btn { display: flex; align-items: center; justify-content: center; gap: 12px; width: 100%; padding: 16px; background: var(--danger-light); border: 1px solid rgba(239,68,68,0.2); border-radius: var(--radius-lg); color: var(--danger); font-family: 'Inter', sans-serif; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .logout-btn:hover { background: var(--danger); color: white; box-shadow: 0 8px 20px rgba(239,68,68,0.3); transform: translateY(-2px); }

        /* ── Main ── */
        .main-content { margin-left: var(--sidebar-width); min-height: 100vh; }
        .header { position: sticky; top: 0; height: var(--header-height); background: rgba(255,255,255,0.92); backdrop-filter: blur(20px); border-bottom: 1px solid var(--border-color); display: flex; align-items: center; justify-content: space-between; padding: 0 36px; z-index: 50; }
        .header-left { display: flex; align-items: center; gap: 24px; }
        .menu-toggle { display: none; width: 46px; height: 46px; border-radius: var(--radius-lg); background: var(--bg-light); border: 1px solid var(--border-color); align-items: center; justify-content: center; cursor: pointer; color: var(--text-secondary); transition: all 0.2s; }
        .menu-toggle:hover { background: var(--bg-gradient); color: var(--primary); }
        .page-header h1 { font-size: 24px; font-weight: 800; color: var(--text-dark); letter-spacing: -0.03em; }
        .breadcrumb { display: flex; align-items: center; gap: 10px; font-size: 13px; color: var(--text-muted); margin-top: 4px; }
        .breadcrumb a { color: var(--text-secondary); text-decoration: none; font-weight: 500; }
        .breadcrumb a:hover { color: var(--primary); }
        .breadcrumb i { font-size: 10px; }
        .header-right { display: flex; align-items: center; gap: 16px; }
        .user-dropdown { display: flex; align-items: center; gap: 14px; padding: 8px 18px 8px 8px; background: var(--bg-light); border: 1px solid var(--border-color); border-radius: var(--radius-lg); cursor: pointer; transition: all 0.2s; }
        .user-dropdown:hover { background: var(--bg-gradient); border-color: var(--primary-lighter); }
        .user-dropdown-avatar { width: 40px; height: 40px; border-radius: var(--radius); background: linear-gradient(135deg, var(--primary), var(--secondary)); display: flex; align-items: center; justify-content: center; color: white; font-size: 14px; font-weight: 700; }
        .user-dropdown-info span { display: block; font-size: 14px; font-weight: 600; color: var(--text-dark); }
        .user-dropdown-info small { font-size: 12px; color: var(--text-muted); }

        /* ── Page Body ── */
        .page-body { padding: 36px; max-width: 1200px; margin: 0 auto; }

        /* ── Banner ── */
        .page-banner { background: linear-gradient(135deg, var(--success) 0%, #059669 60%, #047857 100%); border-radius: var(--radius-2xl); padding: 36px 44px; margin-bottom: 36px; color: white; position: relative; overflow: hidden; box-shadow: 0 20px 50px rgba(16,185,129,0.35); }
        .page-banner::before { content: ''; position: absolute; top: -50%; right: -10%; width: 500px; height: 500px; background: radial-gradient(circle, rgba(255,255,255,0.12) 0%, transparent 60%); animation: float-slow 10s ease-in-out infinite; }
        @keyframes float-slow { 0%,100%{transform:translateY(0) rotate(0deg)} 50%{transform:translateY(-20px) rotate(5deg)} }
        .page-banner-inner { position: relative; z-index: 1; display: flex; align-items: center; justify-content: space-between; }
        .page-banner-text h2 { font-size: 28px; font-weight: 800; margin-bottom: 8px; letter-spacing: -0.02em; }
        .page-banner-text p { font-size: 15px; opacity: 0.9; }
        .page-banner-icon { width: 80px; height: 80px; border-radius: var(--radius-xl); background: rgba(255,255,255,0.18); backdrop-filter: blur(10px); display: flex; align-items: center; justify-content: center; font-size: 36px; border: 1px solid rgba(255,255,255,0.25); }

        /* ── Card ── */
        .card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: var(--radius-xl); box-shadow: var(--shadow-sm); overflow: hidden; margin-bottom: 28px; }
        .card-header { display: flex; align-items: center; justify-content: space-between; padding: 24px 32px; border-bottom: 1px solid var(--border-color); background: var(--bg-lighter); }
        .card-title { display: flex; align-items: center; gap: 16px; }
        .card-title-icon { width: 48px; height: 48px; border-radius: var(--radius-lg); background: var(--bg-gradient); display: flex; align-items: center; justify-content: center; font-size: 20px; color: var(--primary); }
        .card-title div h3 { font-size: 18px; font-weight: 700; color: var(--text-dark); }
        .card-title div p { font-size: 13px; color: var(--text-muted); margin-top: 3px; }
        .card-body { padding: 36px 32px; }

        /* ── Form ── */
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 28px; }
        .form-grid.full { grid-template-columns: 1fr; }
        .form-group { display: flex; flex-direction: column; gap: 10px; }
        .form-group.span2 { grid-column: span 2; }
        .form-label { font-size: 13px; font-weight: 600; color: var(--text-dark); display: flex; align-items: center; gap: 8px; }
        .form-label i { font-size: 12px; color: var(--primary); }
        .form-label .req { color: var(--danger); }
        .input-wrap { position: relative; }
        .input-wrap .icon { position: absolute; left: 18px; top: 50%; transform: translateY(-50%); font-size: 17px; color: var(--text-muted); transition: color 0.2s; pointer-events: none; z-index: 1; }
        .input-wrap input,
        .input-wrap select,
        .input-wrap textarea { width: 100%; padding: 16px 18px 16px 52px; background: var(--bg-light); border: 2px solid transparent; border-radius: var(--radius-lg); font-family: 'Inter', sans-serif; font-size: 15px; color: var(--text-dark); outline: none; transition: all 0.2s; }
        .input-wrap textarea { padding-top: 16px; resize: vertical; min-height: 110px; }
        .input-wrap select { appearance: none; cursor: pointer; }
        .input-wrap .chevron { position: absolute; right: 18px; top: 50%; transform: translateY(-50%); color: var(--text-muted); font-size: 13px; pointer-events: none; }
        .input-wrap input::placeholder, .input-wrap textarea::placeholder { color: var(--text-muted); }
        .input-wrap input:focus, .input-wrap select:focus, .input-wrap textarea:focus { background: var(--bg-white); border-color: var(--primary); box-shadow: 0 0 0 4px rgba(99,102,241,0.1); }
        .input-wrap:focus-within .icon { color: var(--primary); }
        .input-wrap.error input, .input-wrap.error select { border-color: var(--danger); background: var(--danger-light); }
        .input-wrap.error .icon { color: var(--danger); }
        .field-err { display: none; align-items: center; gap: 6px; font-size: 12px; color: var(--danger); font-weight: 500; margin-top: 4px; }
        .input-wrap.error ~ .field-err { display: flex; }

        /* Icon picker */
        .icon-picker { display: grid; grid-template-columns: repeat(8, 1fr); gap: 10px; margin-top: 4px; }
        .icon-opt { width: 48px; height: 48px; border-radius: var(--radius); border: 2px solid var(--border-color); background: var(--bg-light); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 18px; color: var(--text-muted); transition: all 0.2s; }
        .icon-opt:hover { border-color: var(--primary-lighter); color: var(--primary); background: var(--bg-gradient); }
        .icon-opt.selected { border-color: var(--primary); background: linear-gradient(135deg, rgba(99,102,241,0.15), rgba(99,102,241,0.08)); color: var(--primary); box-shadow: 0 0 0 3px rgba(99,102,241,0.15); }

        /* Color picker */
        .color-picker { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 4px; }
        .color-opt { width: 40px; height: 40px; border-radius: 50%; cursor: pointer; border: 3px solid transparent; transition: all 0.2s; position: relative; }
        .color-opt:hover { transform: scale(1.15); }
        .color-opt.selected { border-color: var(--text-dark); box-shadow: 0 0 0 3px rgba(0,0,0,0.15); }
        .color-opt::after { content: '\f00c'; font-family: 'Font Awesome 6 Free'; font-weight: 900; position: absolute; inset: 0; display: none; align-items: center; justify-content: center; color: white; font-size: 14px; }
        .color-opt.selected::after { display: flex; }

        /* Divider */
        .form-divider { display: flex; align-items: center; gap: 16px; margin: 8px 0; }
        .form-divider span { font-size: 12px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.08em; white-space: nowrap; }
        .form-divider hr { flex: 1; border: none; border-top: 1px solid var(--border-color); }

        /* Buttons */
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 10px; padding: 15px 28px; border-radius: var(--radius-lg); font-family: 'Inter', sans-serif; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s; border: none; text-decoration: none; }
        .btn-primary { background: linear-gradient(135deg, var(--success), #059669); color: white; box-shadow: 0 6px 20px rgba(16,185,129,0.35); }
        .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(16,185,129,0.4); }
        .btn-primary:disabled { opacity: 0.7; cursor: not-allowed; transform: none; }
        .btn-secondary { background: var(--bg-light); border: 1px solid var(--border-color); color: var(--text-secondary); }
        .btn-secondary:hover { background: var(--bg-gradient); color: var(--primary); border-color: var(--primary-lighter); }
        .form-actions { display: flex; align-items: center; gap: 16px; margin-top: 12px; padding-top: 28px; border-top: 1px solid var(--border-color); }
        .btn-submit { flex: 1; padding: 18px; font-size: 16px; }

        /* Alert */
        .alert { padding: 16px 20px; border-radius: var(--radius-lg); font-size: 14px; font-weight: 500; display: none; align-items: center; gap: 14px; margin-top: 20px; animation: slideDown 0.4s cubic-bezier(0.34,1.56,0.64,1); }
        @keyframes slideDown { from{opacity:0;transform:translateY(-12px)} to{opacity:1;transform:translateY(0)} }
        .alert.success { display: flex; background: var(--success-light); border: 1px solid rgba(16,185,129,0.25); color: var(--success); }
        .alert.error { display: flex; background: var(--danger-light); border: 1px solid rgba(239,68,68,0.25); color: var(--danger); }
        .alert i { font-size: 20px; flex-shrink: 0; }

        /* Preview card */
        .dept-preview { padding: 28px 32px; background: var(--bg-lighter); border-top: 1px solid var(--border-color); }
        .dept-preview h4 { font-size: 14px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 18px; }
        .preview-card { padding: 24px; border-radius: var(--radius-lg); border: 2px dashed var(--border-color); background: var(--bg-white); transition: all 0.3s; max-width: 380px; }
        .preview-card.filled { border-style: solid; border-color: var(--primary-lighter); background: var(--bg-gradient); }
        .preview-card-header { display: flex; align-items: center; gap: 14px; margin-bottom: 18px; }
        .preview-icon { width: 46px; height: 46px; border-radius: var(--radius); display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .preview-card-header h5 { font-size: 15px; font-weight: 700; color: var(--text-dark); }
        .preview-stats { display: flex; justify-content: space-between; }
        .preview-stat { text-align: center; }
        .preview-stat .val { font-size: 20px; font-weight: 800; color: var(--text-dark); }
        .preview-stat .lbl { font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin-top: 2px; }
        .preview-empty { text-align: center; padding: 12px; color: var(--text-muted); font-size: 13px; }
        .preview-empty i { font-size: 28px; display: block; margin-bottom: 8px; color: var(--border-color); }

        /* Department list at bottom */
        .dept-list-wrap { margin-top: 28px; }
        .dept-list-item { display: flex; align-items: center; justify-content: space-between; padding: 18px 24px; border-bottom: 1px solid var(--border-light); transition: background 0.2s; }
        .dept-list-item:last-child { border-bottom: none; }
        .dept-list-item:hover { background: var(--bg-lighter); }
        .dept-list-info { display: flex; align-items: center; gap: 14px; }
        .dept-list-icon { width: 42px; height: 42px; border-radius: var(--radius); display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
        .dept-list-meta h5 { font-size: 15px; font-weight: 600; color: var(--text-dark); margin-bottom: 3px; }
        .dept-list-meta p { font-size: 12px; color: var(--text-muted); }
        .dept-list-badge { padding: 6px 14px; border-radius: 30px; font-size: 12px; font-weight: 600; background: var(--success-light); color: var(--success); }

        /* Mobile */
        .mobile-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); z-index: 99; }
        .mobile-overlay.active { display: block; }
        @media (max-width:1024px) { .sidebar{transform:translateX(-100%)} .sidebar.mobile-open{transform:translateX(0)} .main-content{margin-left:0} .menu-toggle{display:flex} }
        @media (max-width:768px) { .page-body{padding:20px} .page-banner{padding:24px} .page-banner-icon{display:none} .form-grid{grid-template-columns:1fr} .form-group.span2{grid-column:span 1} .card-body{padding:24px 20px} .icon-picker{grid-template-columns:repeat(5,1fr)} }
        @keyframes shake { 0%,100%{transform:translateX(0)} 20%,60%{transform:translateX(-6px)} 40%,80%{transform:translateX(6px)} }
    </style>
</head>
<body>

<!-- Sidebar -->
<aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <div class="logo-box"><i class="fas fa-building"></i></div>
        <div class="logo-info"><h1>EMS Pro</h1><span>Admin Panel</span></div>
    </div>
    <div class="admin-profile-card">
        <div class="admin-profile-inner">
            <div class="admin-avatar"><i class="fas fa-user-tie"></i><span class="status-indicator"></span></div>
            <div class="admin-meta"><h4 id="sidebarName">Admin User</h4><p id="sidebarEmail">admin@company.com</p></div>
        </div>
        <div class="admin-role-badge"><i class="fas fa-shield-halved"></i> Organization Administrator</div>
    </div>
    <nav class="sidebar-nav">
        <div class="nav-section">
            <div class="nav-section-label">Main Menu</div>
            <a href="/admindashboard" class="nav-link"><i class="fas fa-th-large"></i><span>Dashboard</span></a>
            <a href="#" class="nav-link"><i class="fas fa-chart-line"></i><span>Analytics</span></a>
        </div>
        <div class="nav-section">
            <div class="nav-section-label">Organization</div>
            <a href="#" class="nav-link"><i class="fas fa-user-tie"></i><span>Managers</span></a>
            <a href="#" class="nav-link"><i class="fas fa-users"></i><span>All Employees</span></a>
            <a href="/adddepartments" class="nav-link active"><i class="fas fa-sitemap"></i><span>Departments</span></a>
            <a href="/addmanager" class="nav-link"><i class="fas fa-user-plus"></i><span>Add Manager</span></a>
        </div>
        <div class="nav-section">
            <div class="nav-section-label">Operations</div>
            <a href="#" class="nav-link"><i class="fas fa-calendar-check"></i><span>Attendance</span></a>
            <a href="#" class="nav-link"><i class="fas fa-plane-departure"></i><span>Leave Requests</span><span class="badge warning">8</span></a>
            <a href="#" class="nav-link"><i class="fas fa-money-bill-wave"></i><span>Payroll</span></a>
        </div>
        <div class="nav-section">
            <div class="nav-section-label">Settings</div>
            <a href="#" class="nav-link"><i class="fas fa-cog"></i><span>Settings</span></a>
            <a href="#" class="nav-link"><i class="fas fa-bell"></i><span>Notifications</span><span class="badge info">3</span></a>
        </div>
    </nav>
    <div class="sidebar-footer">
        <button class="logout-btn" onclick="logout()"><i class="fas fa-power-off"></i> Sign Out</button>
    </div>
</aside>

<div class="mobile-overlay" id="mobileOverlay" onclick="closeMobileMenu()"></div>

<!-- Main -->
<main class="main-content">
    <header class="header">
        <div class="header-left">
            <button class="menu-toggle" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
            <div class="page-header">
                <h1>Add Department</h1>
                <div class="breadcrumb">
                    <a href="/admindashboard">Home</a>
                    <i class="fas fa-chevron-right"></i>
                    <a href="#">Departments</a>
                    <i class="fas fa-chevron-right"></i>
                    <span>Add New</span>
                </div>
            </div>
        </div>
        <div class="header-right">
            <div class="user-dropdown">
                <div class="user-dropdown-avatar" id="headerAvatar">AD</div>
                <div class="user-dropdown-info">
                    <span id="headerName">Admin</span>
                    <small>Administrator</small>
                </div>
                <i class="fas fa-chevron-down" style="font-size:12px;color:var(--text-muted);margin-left:8px"></i>
            </div>
        </div>
    </header>

    <div class="page-body">
        <!-- Banner -->
        <div class="page-banner">
            <div class="page-banner-inner">
                <div class="page-banner-text">
                    <h2><i class="fas fa-sitemap" style="margin-right:10px"></i>Create New Department</h2>
                    <p>Organise your workforce by adding departments to your organisation.</p>
                </div>
                <div class="page-banner-icon"><i class="fas fa-sitemap"></i></div>
            </div>
        </div>

        <div style="display:grid;grid-template-columns:1fr 380px;gap:28px;align-items:start">

            <!-- Form Card -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-title-icon"><i class="fas fa-plus-circle"></i></div>
                        <div><h3>Department Details</h3><p>Fill in the information below</p></div>
                    </div>
                </div>
                <div class="card-body">
                    <form id="deptForm">

                        <!-- Department Name -->
                        <div class="form-group" style="margin-bottom:24px">
                            <label class="form-label"><i class="fas fa-tag"></i> Department Name <span class="req">*</span></label>
                            <div class="input-wrap" id="nameWrap">
                                <i class="fas fa-tag icon"></i>
                                <input type="text" id="deptName" placeholder="e.g. Engineering, Marketing, Sales…" maxlength="100" oninput="updatePreview()">
                            </div>
                            <div class="field-err"><i class="fas fa-circle-exclamation"></i> Please enter a department name.</div>
                        </div>

                        <!-- Description -->
                        <div class="form-group" style="margin-bottom:24px">
                            <label class="form-label"><i class="fas fa-align-left"></i> Description <span style="color:var(--text-muted);font-weight:400">(Optional)</span></label>
                            <div class="input-wrap">
                                <i class="fas fa-align-left icon" style="top:22px;transform:none"></i>
                                <textarea id="deptDesc" placeholder="Briefly describe what this department does…" oninput="updatePreview()"></textarea>
                            </div>
                        </div>

                        <div class="form-divider"><hr><span>Appearance</span><hr></div>

                        <!-- Icon Picker -->
                        <div class="form-group" style="margin-bottom:24px">
                            <label class="form-label"><i class="fas fa-icons"></i> Department Icon</label>
                            <div class="icon-picker" id="iconPicker">
                                <div class="icon-opt selected" data-icon="fa-building" onclick="selectIcon(this)"><i class="fas fa-building"></i></div>
                                <div class="icon-opt" data-icon="fa-code" onclick="selectIcon(this)"><i class="fas fa-code"></i></div>
                                <div class="icon-opt" data-icon="fa-bullhorn" onclick="selectIcon(this)"><i class="fas fa-bullhorn"></i></div>
                                <div class="icon-opt" data-icon="fa-chart-bar" onclick="selectIcon(this)"><i class="fas fa-chart-bar"></i></div>
                                <div class="icon-opt" data-icon="fa-users" onclick="selectIcon(this)"><i class="fas fa-users"></i></div>
                                <div class="icon-opt" data-icon="fa-coins" onclick="selectIcon(this)"><i class="fas fa-coins"></i></div>
                                <div class="icon-opt" data-icon="fa-cogs" onclick="selectIcon(this)"><i class="fas fa-cogs"></i></div>
                                <div class="icon-opt" data-icon="fa-server" onclick="selectIcon(this)"><i class="fas fa-server"></i></div>
                                <div class="icon-opt" data-icon="fa-pen-nib" onclick="selectIcon(this)"><i class="fas fa-pen-nib"></i></div>
                                <div class="icon-opt" data-icon="fa-headset" onclick="selectIcon(this)"><i class="fas fa-headset"></i></div>
                                <div class="icon-opt" data-icon="fa-truck" onclick="selectIcon(this)"><i class="fas fa-truck"></i></div>
                                <div class="icon-opt" data-icon="fa-scale-balanced" onclick="selectIcon(this)"><i class="fas fa-scale-balanced"></i></div>
                                <div class="icon-opt" data-icon="fa-flask" onclick="selectIcon(this)"><i class="fas fa-flask"></i></div>
                                <div class="icon-opt" data-icon="fa-stethoscope" onclick="selectIcon(this)"><i class="fas fa-stethoscope"></i></div>
                                <div class="icon-opt" data-icon="fa-graduation-cap" onclick="selectIcon(this)"><i class="fas fa-graduation-cap"></i></div>
                                <div class="icon-opt" data-icon="fa-shield-halved" onclick="selectIcon(this)"><i class="fas fa-shield-halved"></i></div>
                            </div>
                        </div>

                        <!-- Color Picker -->
                        <div class="form-group" style="margin-bottom:32px">
                            <label class="form-label"><i class="fas fa-palette"></i> Theme Color</label>
                            <div class="color-picker" id="colorPicker">
                                <div class="color-opt selected" data-color="#6366f1" style="background:#6366f1" onclick="selectColor(this)"></div>
                                <div class="color-opt" data-color="#0ea5e9" style="background:#0ea5e9" onclick="selectColor(this)"></div>
                                <div class="color-opt" data-color="#10b981" style="background:#10b981" onclick="selectColor(this)"></div>
                                <div class="color-opt" data-color="#f59e0b" style="background:#f59e0b" onclick="selectColor(this)"></div>
                                <div class="color-opt" data-color="#f43f5e" style="background:#f43f5e" onclick="selectColor(this)"></div>
                                <div class="color-opt" data-color="#8b5cf6" style="background:#8b5cf6" onclick="selectColor(this)"></div>
                                <div class="color-opt" data-color="#14b8a6" style="background:#14b8a6" onclick="selectColor(this)"></div>
                                <div class="color-opt" data-color="#f97316" style="background:#f97316" onclick="selectColor(this)"></div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <a href="/admindashboard" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Cancel</a>
                            <button type="submit" class="btn btn-primary btn-submit" id="submitBtn">
                                <i class="fas fa-plus-circle"></i> Create Department
                            </button>
                        </div>
                        <div class="alert" id="formAlert"></div>
                    </form>
                </div>

                <!-- Live Preview -->
                <div class="dept-preview">
                    <h4><i class="fas fa-eye" style="margin-right:8px;color:var(--primary)"></i>Live Preview</h4>
                    <div class="preview-card" id="previewCard">
                        <div class="preview-empty">
                            <i class="fas fa-sitemap"></i>
                            Start typing to see preview
                        </div>
                    </div>
                </div>
            </div>

            <!-- Existing Departments -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-title-icon"><i class="fas fa-sitemap"></i></div>
                        <div><h3>Existing Departments</h3><p id="deptListCount">Loading…</p></div>
                    </div>
                </div>
                <div class="card-body" style="padding:0">
                    <div id="deptList">
                        <div style="padding:32px;text-align:center;color:var(--text-muted)">
                            <i class="fas fa-spinner fa-spin" style="font-size:24px;margin-bottom:12px;display:block;color:var(--primary)"></i>
                            Loading departments…
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</main>

<script>
    // ── State ─────────────────────────────────────────────────────────────────
    let selectedIcon  = 'fa-building';
    let selectedColor = '#6366f1';

    // ── Sidebar ───────────────────────────────────────────────────────────────
    function toggleSidebar()  { document.getElementById('sidebar').classList.toggle('mobile-open'); document.getElementById('mobileOverlay').classList.toggle('active'); }
    function closeMobileMenu(){ document.getElementById('sidebar').classList.remove('mobile-open'); document.getElementById('mobileOverlay').classList.remove('active'); }
    window.addEventListener('resize',()=>{ if(window.innerWidth>1024){ document.getElementById('sidebar').classList.remove('mobile-open'); document.getElementById('mobileOverlay').classList.remove('active'); } });

    // ── Logout ────────────────────────────────────────────────────────────────
    function logout() { if(confirm('Sign out?')){ localStorage.removeItem('token'); localStorage.removeItem('user_data'); window.location.href='/login'; } }

    // ── Icon & Color pickers ──────────────────────────────────────────────────
    function selectIcon(el) {
        document.querySelectorAll('.icon-opt').forEach(o => o.classList.remove('selected'));
        el.classList.add('selected');
        selectedIcon = el.dataset.icon;
        updatePreview();
    }
    function selectColor(el) {
        document.querySelectorAll('.color-opt').forEach(o => o.classList.remove('selected'));
        el.classList.add('selected');
        selectedColor = el.dataset.color;
        updatePreview();
    }

    // ── Live Preview ──────────────────────────────────────────────────────────
    function updatePreview() {
        const name = document.getElementById('deptName').value.trim();
        const card = document.getElementById('previewCard');
        if (!name) {
            card.classList.remove('filled');
            card.innerHTML = `<div class="preview-empty"><i class="fas fa-sitemap"></i>Start typing to see preview</div>`;
            return;
        }
        const bg = selectedColor + '22';
        card.classList.add('filled');
        card.innerHTML = `
            <div class="preview-card-header">
                <div class="preview-icon" style="background:${bg};color:${selectedColor}"><i class="fas ${selectedIcon}"></i></div>
                <h5>${escHtml(name)}</h5>
            </div>
            <div class="preview-stats">
                <div class="preview-stat"><div class="val">0</div><div class="lbl">Employees</div></div>
                <div class="preview-stat"><div class="val">0</div><div class="lbl">Managers</div></div>
                <div class="preview-stat"><div class="val">0</div><div class="lbl">Teams</div></div>
            </div>`;
    }

    function escHtml(s){ const d=document.createElement('div'); d.appendChild(document.createTextNode(s)); return d.innerHTML; }

    // ── Load existing departments ─────────────────────────────────────────────
    async function loadExistingDepts() {
        const token = localStorage.getItem('token');
        try {
            const res  = await fetch('/get_departments', { headers: { 'Authorization': `Bearer ${token}` } });
            const data = await res.json();
            const list = document.getElementById('deptList');
            const count= document.getElementById('deptListCount');
            const deps = data.dep_data || [];

            if (!deps.length) {
                list.innerHTML = `<div style="padding:32px;text-align:center;color:var(--text-muted);font-size:14px"><i class="fas fa-inbox" style="font-size:28px;display:block;margin-bottom:10px;color:var(--border-color)"></i>No departments yet</div>`;
                count.textContent = '0 departments';
                return;
            }
            count.textContent = `${deps.length} department${deps.length!==1?'s':''}`;
            const colors = ['#6366f1','#0ea5e9','#10b981','#f59e0b','#f43f5e','#8b5cf6','#14b8a6','#f97316'];
            list.innerHTML = deps.map((d, i) => {
                const c    = colors[i % colors.length];
                const name = d.department_name || d.name || d.dept_name || 'Department';
                return `
                <div class="dept-list-item">
                    <div class="dept-list-info">
                        <div class="dept-list-icon" style="background:${c}22;color:${c}"><i class="fas fa-building"></i></div>
                        <div class="dept-list-meta">
                            <h5>${escHtml(name)}</h5>
                            <p>Created ${d.created_at ? new Date(d.created_at).toLocaleDateString() : 'recently'}</p>
                        </div>
                    </div>
                    <span class="dept-list-badge">Active</span>
                </div>`;
            }).join('');
        } catch(e) {
            document.getElementById('deptList').innerHTML = `<div style="padding:24px;text-align:center;color:var(--danger);font-size:13px"><i class="fas fa-triangle-exclamation"></i> Failed to load</div>`;
        }
    }

    // ── Form Submit → POST /adddepartments ───────────────────────────────────
    document.getElementById('deptForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const nameWrap = document.getElementById('nameWrap');
        const nameVal  = document.getElementById('deptName').value.trim();
        const alertEl  = document.getElementById('formAlert');
        const submitBtn= document.getElementById('submitBtn');

        // Reset
        nameWrap.classList.remove('error');
        alertEl.className = 'alert';

        if (!nameVal) {
            nameWrap.classList.add('error');
            submitBtn.style.animation = 'shake 0.4s ease';
            setTimeout(()=>submitBtn.style.animation='', 400);
            return;
        }

        // Loading state
        const orig = submitBtn.innerHTML;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating…';
        submitBtn.disabled = true;

        try {
            const token = localStorage.getItem('token');
            const res   = await fetch('/adddepartments', {
                method : 'POST',
                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                body   : JSON.stringify({ department: nameVal })
            });
            const data = await res.json();

            if (data.status === 'success' || res.ok) {
                alertEl.className = 'alert success';
                alertEl.innerHTML = `<i class="fas fa-circle-check"></i><span>${data.message || 'Department created successfully!'}</span>`;
                this.reset();
                document.querySelectorAll('.icon-opt').forEach(o=>o.classList.remove('selected'));
                document.querySelector('[data-icon="fa-building"]').classList.add('selected');
                document.querySelectorAll('.color-opt').forEach(o=>o.classList.remove('selected'));
                document.querySelector('[data-color="#6366f1"]').classList.add('selected');
                selectedIcon = 'fa-building'; selectedColor = '#6366f1';
                updatePreview();
                loadExistingDepts();
                setTimeout(()=>alertEl.className='alert', 5000);
            } else {
                alertEl.className = 'alert error';
                alertEl.innerHTML = `<i class="fas fa-circle-xmark"></i><span>${data.message || 'Failed to create department.'}</span>`;
            }
        } catch(err) {
            alertEl.className = 'alert error';
            alertEl.innerHTML = `<i class="fas fa-triangle-exclamation"></i><span>Connection error. Please try again.</span>`;
        }
        submitBtn.innerHTML = orig;
        submitBtn.disabled = false;
    });

    // ── Init ──────────────────────────────────────────────────────────────────
    window.addEventListener('load', () => {
        const userData = localStorage.getItem('user_data');
        if (userData) {
            const u = JSON.parse(userData);
            const name = u.name || 'Admin';
            document.getElementById('sidebarName').textContent = name;
            document.getElementById('sidebarEmail').textContent = u.email || '';
            document.getElementById('headerName').textContent = name.split(' ')[0];
            document.getElementById('headerAvatar').textContent = name.split(' ').map(n=>n[0]).join('').toUpperCase().slice(0,2);
        }
        loadExistingDepts();
    });
</script>
</body>
</html>